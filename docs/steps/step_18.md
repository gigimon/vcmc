# Step 18: Загрузка контента и smart fallback

## Цель
Реализовать загрузчик контента для `Viewer` с верхним лимитом чтения, бинарной эвристикой и безопасной подготовкой строк для TUI.

## Решения
- Добавлен новый модуль `src/viewer.rs` с функцией `load_viewer_state(path, title, byte_size)`.
- Для чтения используется верхний лимит preview `256 KB`:
  - читается максимум `limit + 1` байт;
  - при превышении лимита контент обрезается и помечается как `truncated`.
- Добавлена эвристика `binary-like`:
  - наличие NUL-байтов;
  - или доля непечатаемых байтов > `30%`.
- Текстовый путь (`text`):
  - нормализация переводов строк (`CRLF/CR -> LF`);
  - разворачивание табов в пробелы (tab stop = 4);
  - ограничение длины строки (`512` символов, с `...`).
- Бинарный путь (`binary-like`):
  - вывод metadata (`Path`, `Type`, `Size`, `Loaded preview`);
  - lossy-preview первых `8 KB` с безопасной ASCII-санитизацией.
- `App::open_viewer` переведен на реальный loader вместо заглушки.
- Добавлены unit-тесты `src/viewer.rs`:
  - эвристика binary-like;
  - нормализация текста;
  - ограничение длины строк;
  - индикация обрезанного preview.

## Checklist
[x] Реализовать `viewer_loader`: чтение файла с верхним лимитом (например 256 KB для preview).
[x] Добавить эвристику binary-like (NUL-байты/доля непечатаемых символов).
[x] Для текста: нормализация строк и табов, безопасное ограничение длины строки.
[x] Для binary-like: показывать metadata + lossy-предпросмотр первых N KB.

## Прогресс
- 2026-02-13: step создан.
- 2026-02-13: добавлен модуль `src/viewer.rs` с loader и smart fallback логикой.
- 2026-02-13: `open_viewer` интегрирован с loader.
- 2026-02-13: добавлены unit-тесты viewer-модуля.
- 2026-02-13: `cargo fmt` и `cargo test` успешно.
