# Description
Цель: сделать быстрый консольный файловый менеджер в стиле Midnight Commander с акцентом на отзывчивость UI и предсказуемые файловые операции.

Принятые решения:
- Язык: Rust (stable).
- TUI-стек: `ratatui` + `crossterm`.
- Архитектура: основной event loop + фоновые worker-потоки для долгих операций.
- Платформы первой итерации: macOS + Linux (POSIX-first).
- Удаление в v1: permanent delete с обязательным подтверждением.

Нефункциональные требования для v1:
- Быстрый старт и навигация по большим каталогам.
- UI не должен зависать во время копирования/перемещения.
- Минимальные аллокации в hot-path (рендер/навигация/листинг).
- Явные сообщения об ошибках и безопасные подтверждения для рискованных операций.

MVP-функции (итерация 1):
- Две панели (левая/правая), активная панель, переключение по `Tab`.
- Навигация: `Up/Down`, `Enter`, `Backspace`, переход к домашней директории.
- Операции: копировать, переместить, удалить (с подтверждением), создать папку.
- Сортировка: по имени/размеру/дате (переключаемые режимы).
- Поиск по имени в текущем каталоге.
- Строка подсказок с хоткеями и строка статуса (путь, число элементов, ошибки).

# Implementation

## Step 1: Bootstrap и каркас проекта
[x] Инициализировать `cargo`-проект (`bin`) и базовую структуру модулей.
[x] Подключить зависимости: `ratatui`, `crossterm`, `crossbeam-channel`, `walkdir`, `anyhow`, `thiserror`, `tracing`, `tracing-subscriber`.
[x] Описать базовые сущности: `AppState`, `PanelState`, `FsEntry`, `Command`, `Event`, `Job`.
[x] Добавить graceful shutdown и восстановление терминала при panic/ошибке.

## Step 2: Слой доменной модели и FS-адаптер
[] Реализовать POSIX-ориентированный FS-адаптер (листинг, stat, mkdir, remove, rename/move, copy).
[] Ввести нормализацию и валидацию путей (absolute/canonical где нужно).
[] Добавить сортировки (name/size/mtime) и базовую фильтрацию скрытых файлов.
[] Подготовить единый тип ошибок с понятной классификацией (permission, not found, io).

## Step 3: Event loop и конкурентная модель
[] Реализовать главный цикл обработки: input events, ticks, worker responses.
[] Поднять worker pool для долгих операций (copy/move/delete) через каналы.
[] Добавить очередь задач и модель прогресса (`Queued`, `Running`, `Done`, `Failed`).
[] Гарантировать неизменность UI-потока: любые тяжелые операции только через воркеры.

## Step 4: Базовый UI (две панели)
[] Собрать layout: header, две панели, status bar, help bar.
[] Реализовать визуальные состояния: активная панель, выделение, пустой каталог, ошибка.
[] Добавить адаптацию к resize терминала.
[] Настроить компактный рендер без лишних перерисовок состояния.

## Step 5: Навигация и управление фокусом
[] Горячие клавиши: `Tab`, `Up/Down`, `Enter`, `Backspace`, `q`.
[] Переход по каталогам и корректная обработка `..`.
[] Поддержать быстрый jump в домашний каталог.
[] Синхронизировать UI и `AppState` без рассогласований между панелями.

## Step 6: Файловые операции MVP
[] Копирование из активной панели в неактивную (через job).
[] Перемещение из активной панели в неактивную (через job).
[] Удаление (permanent) с обязательным confirm-диалогом.
[] Создание директории в активной панели.
[] Показ результата операции и ошибок в status/log области.

## Step 7: Поиск и сортировка
[] Реализовать поиск по подстроке имени в текущем каталоге (инкрементально).
[] Добавить переключение режимов сортировки хоткеем.
[] Сохранить выбранную сортировку per-panel.
[] Обновлять видимый список без блокировки UI.

## Step 8: UX-доработки и надежность
[] Добавить модальные окна подтверждений и ошибок (удаление/конфликты).
[] Ввести стратегию конфликтов имен при copy/move (минимум: abort + сообщение).
[] Улучшить сообщения об ошибках с контекстом пути/операции.
[] Добавить guard-rails для опасных действий (удаление директории, permission denied).

## Step 9: Проверка производительности и релиз v1
[] Smoke-проверка на больших каталогах (время первого листинга, latency навигации).
[] Проверка поведения под долгими задачами копирования (UI отзывчив).
[] Подготовить README: хоткеи, ограничения POSIX-first, known issues.
[] Сформировать backlog для итерации 2 (архивы, предпросмотр, multi-select, tabs).

# Definition of Done (итерация 1)
[] Двухпанельная навигация стабильна и без UI-фризов.
[] Основные операции (copy/move/delete/mkdir) выполняются через jobs и отображают статус.
[] Поиск и сортировка работают в обеих панелях.
[] Терминал корректно восстанавливается после штатного/аварийного выхода.
[] Документация по запуску и хоткеям готова.
