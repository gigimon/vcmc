# Description
Цель: сделать быстрый консольный файловый менеджер в стиле Midnight Commander с акцентом на отзывчивость UI и предсказуемые файловые операции.

Принятые решения:
- Язык: Rust (stable).
- TUI-стек: `ratatui` + `crossterm`.
- Архитектура: основной event loop + фоновые worker-потоки для долгих операций.
- Платформы первой итерации: macOS + Linux (POSIX-first).
- Удаление в v1: permanent delete с обязательным подтверждением.

Нефункциональные требования для v1:
- Быстрый старт и навигация по большим каталогам.
- UI не должен зависать во время копирования/перемещения.
- Минимальные аллокации в hot-path (рендер/навигация/листинг).
- Явные сообщения об ошибках и безопасные подтверждения для рискованных операций.

MVP-функции (итерация 1):
- Две панели (левая/правая), активная панель, переключение по `Tab`.
- Навигация: `Up/Down`, `Enter`, `Backspace`, переход к домашней директории.
- Операции: копировать, переместить, удалить (с подтверждением), создать папку.
- Сортировка: по имени/размеру/дате (переключаемые режимы).
- Поиск по имени в текущем каталоге.
- Строка подсказок с хоткеями и строка статуса (путь, число элементов, ошибки).

# Implementation

## Step 1: Bootstrap и каркас проекта
[x] Инициализировать `cargo`-проект (`bin`) и базовую структуру модулей.
[x] Подключить зависимости: `ratatui`, `crossterm`, `crossbeam-channel`, `walkdir`, `anyhow`, `thiserror`, `tracing`, `tracing-subscriber`.
[x] Описать базовые сущности: `AppState`, `PanelState`, `FsEntry`, `Command`, `Event`, `Job`.
[x] Добавить graceful shutdown и восстановление терминала при panic/ошибке.

## Step 2: Слой доменной модели и FS-адаптер
[x] Реализовать POSIX-ориентированный FS-адаптер (листинг, stat, mkdir, remove, rename/move, copy).
[x] Ввести нормализацию и валидацию путей (absolute/canonical где нужно).
[x] Добавить сортировки (name/size/mtime) и базовую фильтрацию скрытых файлов.
[x] Подготовить единый тип ошибок с понятной классификацией (permission, not found, io).

## Step 3: Event loop и конкурентная модель
[x] Реализовать главный цикл обработки: input events, ticks, worker responses.
[x] Поднять worker pool для долгих операций (copy/move/delete) через каналы.
[x] Добавить очередь задач и модель прогресса (`Queued`, `Running`, `Done`, `Failed`).
[x] Гарантировать неизменность UI-потока: любые тяжелые операции только через воркеры.

## Step 4: Базовый UI (две панели)
[x] Собрать layout: header, две панели, status bar, help bar.
[x] Реализовать визуальные состояния: активная панель, выделение, пустой каталог, ошибка.
[x] Добавить адаптацию к resize терминала.
[x] Настроить компактный рендер без лишних перерисовок состояния.

## Step 5: Навигация и управление фокусом
[x] Горячие клавиши: `Tab`, `Up/Down`, `Enter`, `Backspace`, `q`.
[x] Переход по каталогам и корректная обработка `..`.
[x] Поддержать быстрый jump в домашний каталог.
[x] Синхронизировать UI и `AppState` без рассогласований между панелями.

## Step 6: Файловые операции MVP
[x] Копирование из активной панели в неактивную (через job).
[x] Перемещение из активной панели в неактивную (через job).
[x] Удаление (permanent) с обязательным confirm-диалогом.
[x] Создание директории в активной панели.
[x] Показ результата операции и ошибок в status/log области.

## Step 7: Поиск и сортировка
[x] Реализовать поиск по подстроке имени в текущем каталоге (инкрементально).
[x] Добавить переключение режимов сортировки хоткеем.
[x] Сохранить выбранную сортировку per-panel.
[x] Обновлять видимый список без блокировки UI.

## Step 8: UX-доработки и надежность
[x] Добавить модальные окна подтверждений и ошибок (удаление/конфликты).
[x] Ввести стратегию конфликтов имен при copy/move (минимум: abort + сообщение).
[x] Улучшить сообщения об ошибках с контекстом пути/операции.
[x] Добавить guard-rails для опасных действий (удаление директории, permission denied).

## Step 9: Проверка производительности и релиз v1
[x] Smoke-проверка на больших каталогах (время первого листинга, latency навигации).
[x] Проверка поведения под долгими задачами копирования (UI отзывчив).
[x] Подготовить README: хоткеи, ограничения POSIX-first, known issues.
[x] Сформировать backlog для итерации 2 (архивы, предпросмотр, multi-select, tabs).

## Step 10: Rename Dialogs и табличный UI
[x] Добавить окно изменения имени для copy/move перед постановкой job.
[x] Показать список файлов в колонках `Name | Size | Modified`.
[x] Сохранить цветовую дифференциацию file/dir/symlink и корректный highlight selection.

# Definition of Done (итерация 1)
[x] Двухпанельная навигация стабильна и без UI-фризов.
[x] Основные операции (copy/move/delete/mkdir) выполняются через jobs и отображают статус.
[x] Поиск и сортировка работают в обеих панелях.
[x] Терминал корректно восстанавливается после штатного/аварийного выхода.
[x] Документация по запуску и хоткеям готова.
